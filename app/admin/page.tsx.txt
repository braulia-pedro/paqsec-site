"use client"

import { useState } from "react"
//import { supabase } from "@/lib/supabaseClient"

export default function AdminPage() {
  const [title, setTitle] = useState("")
  const [content, setContent] = useState("")
  const [image, setImage] = useState<File | null>(null)

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()

    let imageUrl = null

    if (image) {
      const { data, error } = await supabase.storage
        .from("posts")
        .upload(`images/${Date.now()}-${image.name}`, image)

      if (error) {
        console.error("Erro upload:", error)
        return
      }

      const { data: publicUrl } = supabase.storage
        .from("posts")
        .getPublicUrl(data.path)

      imageUrl = publicUrl.publicUrl
    }

    const { error } = await supabase.from("posts").insert({
      title,
      content,
      image_url: imageUrl,
    })

    if (error) {
      console.error("Erro salvar post:", error)
    } else {
      alert("✅ Post criado com sucesso!")
      setTitle("")
      setContent("")
      setImage(null)
    }
  }

  return (
    <main className="p-6 max-w-xl mx-auto">
      <h1 className="text-2xl font-bold mb-4">Criar Post</h1>
      <form onSubmit={handleSubmit} className="flex flex-col gap-4">
        <input
          type="text"
          placeholder="Título"
          value={title}
          onChange={(e) => setTitle(e.target.value)}
          className="border p-2 rounded"
          required
        />
        <textarea
          placeholder="Conteúdo"
          value={content}
          onChange={(e) => setContent(e.target.value)}
          className="border p-2 rounded"
        />
        <input type="file" onChange={(e) => setImage(e.target.files?.[0] ?? null)} />
        <button type="submit" className="bg-blue-500 text-white p-2 rounded">
          Publicar
        </button>
      </form>
    </main>
  )
}
